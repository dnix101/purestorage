#cloud-config

# Create administrative user
users:
  - default
  - name: ${username}
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: sudo
    shell: /bin/bash
    ssh_authorized_keys:
      - ${public-key}

# Install required software packages
packages:
  - vim
  - net-tools
  - python3-pip

runcmd:
  - pip3 install --upgrade pip
  - cd /home/${username}/
  - curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
  - chmod +x kubectl
  - mv kubectl /usr/local/bin/
  - git clone https://github.com/kubernetes-sigs/kubespray.git
  - chown -R ${username}:${username} kubespray
  - cd kubespray
  - pip install -r requirements.txt